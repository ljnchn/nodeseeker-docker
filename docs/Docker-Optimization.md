# Docker éƒ¨ç½²ä¼˜åŒ–æŒ‡å—

## ğŸ”§ ä¼˜åŒ–å†…å®¹æ¦‚è§ˆ

æœ¬æ¬¡ä¼˜åŒ–ä¸»è¦è§£å†³äº†ä»¥ä¸‹é—®é¢˜å¹¶æå‡äº† Docker éƒ¨ç½²çš„ç¨³å®šæ€§å’Œæ€§èƒ½ï¼š

### âœ… ä¿®å¤çš„é—®é¢˜

1. **ç«¯å£ä¸ä¸€è‡´é—®é¢˜**
   - ç»Ÿä¸€ç«¯å£é…ç½®ä¸º 3010
   - ä¿®æ­£ Dockerfile å’Œ docker-compose.yml ä¸­çš„ç«¯å£æ˜ å°„

2. **å¥åº·æ£€æŸ¥ç¼ºå¤±**
   - åœ¨ Dockerfile ä¸­æ·»åŠ  curl å·¥å…·
   - é…ç½®å®Œæ•´çš„å¥åº·æ£€æŸ¥æœºåˆ¶

3. **æƒé™é—®é¢˜**
   - ä¼˜åŒ–é root ç”¨æˆ·æƒé™è®¾ç½®
   - ç¡®ä¿æ•°æ®å’Œæ—¥å¿—ç›®å½•çš„æ­£ç¡®æƒé™

4. **ç¯å¢ƒå˜é‡é…ç½®**
   - æ›´æ–° .env.example æ¨¡æ¿
   - æ·»åŠ è¯¦ç»†çš„é…ç½®è¯´æ˜å’Œå®‰å…¨æç¤º

### ğŸš€ æ€§èƒ½ä¼˜åŒ–

1. **Docker æ„å»ºä¼˜åŒ–**
   - ä¼˜åŒ–æ„å»ºå±‚ç¼“å­˜ç­–ç•¥
   - åˆ†ç¦»æºä»£ç å¤åˆ¶ä»¥æé«˜ç¼“å­˜æ•ˆç‡
   - å¤šé˜¶æ®µæ„å»ºå‡å°‘æœ€ç»ˆé•œåƒå¤§å°

2. **ç®€åŒ–æ¶æ„**
   - ç§»é™¤ Nginx ä»£ç†å±‚ï¼Œç›´æ¥æš´éœ²åº”ç”¨ç«¯å£
   - å‡å°‘ç»„ä»¶å¤æ‚åº¦ï¼Œæé«˜éƒ¨ç½²æ•ˆç‡
   - åº”ç”¨è‡ªèº«å¤„ç†æ‰€æœ‰ HTTP è¯·æ±‚

3. **æ—¥å¿—ç®¡ç†**
   - é…ç½®æ—¥å¿—è½®è½¬
   - ç»Ÿä¸€æ—¥å¿—å­˜å‚¨ç­–ç•¥

## ğŸ› ï¸ éƒ¨ç½²æŒ‡å—

### å¿«é€Ÿå¯åŠ¨

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd NodeSeeker-docker

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯ JWT_SECRET

# 3. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 4. æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps
docker-compose logs -f nodeseeker
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

```bash
# ä½¿ç”¨ç”Ÿäº§é…ç½®
docker-compose -f docker-compose.prod.yml up -d

# æ£€æŸ¥å¥åº·çŠ¶æ€
curl http://localhost:3010/health
```

### æœåŠ¡è®¿é—®

- **åº”ç”¨è®¿é—®**: http://localhost:3010
- **å¥åº·æ£€æŸ¥**: http://localhost:3010/health
- **API æ¥å£**: http://localhost:3010/api/

## ğŸ“‹ é…ç½®è¦ç‚¹

### å¿…é¡»é…ç½®é¡¹

1. **JWT_SECRET**: ç”Ÿäº§ç¯å¢ƒå¿…é¡»è®¾ç½®å¼ºå¯†ç ï¼ˆ32å­—ç¬¦ä»¥ä¸Šï¼‰
2. **CORS_ORIGINS**: è®¾ç½®ä¸ºå®é™…åŸŸå
3. **Telegramé…ç½®**: é€šè¿‡ Web ç•Œé¢æˆ–ç¯å¢ƒå˜é‡è®¾ç½®

### æ¨èé…ç½®

1. **èµ„æºé™åˆ¶**: ç”Ÿäº§ç¯å¢ƒå·²é…ç½®å†…å­˜å’Œ CPU é™åˆ¶
2. **è‡ªåŠ¨æ›´æ–°**: Watchtower æœåŠ¡å¯é€‰å¯ç”¨
3. **åå‘ä»£ç†**: å¦‚éœ€è¦ï¼Œå¯åœ¨å¤–éƒ¨é…ç½® Nginx/Traefik

## ğŸ” å®‰å…¨ç‰¹æ€§

1. **é root ç”¨æˆ·**: å®¹å™¨å†…ä½¿ç”¨éç‰¹æƒç”¨æˆ·è¿è¡Œ
2. **åº”ç”¨çº§å®‰å…¨**: å†…ç½®é€Ÿç‡é™åˆ¶å’Œå®‰å…¨å¤´è®¾ç½®
3. **å¥åº·æ£€æŸ¥**: è‡ªåŠ¨æ£€æµ‹å’Œé‡å¯å¼‚å¸¸å®¹å™¨
4. **ç¯å¢ƒå˜é‡**: æ•æ„Ÿä¿¡æ¯é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æŸ¥çœ‹æ—¥å¿—
```bash
# åº”ç”¨æ—¥å¿—
docker-compose logs -f nodeseeker

# å®æ—¶æ—¥å¿—
docker-compose logs -f --tail=100 nodeseeker
```

### å¤‡ä»½æ•°æ®
```bash
# å¤‡ä»½æ•°æ®åº“
docker cp nodeseeker-app:/usr/src/app/data ./backup/

# ä½¿ç”¨å·å¤‡ä»½
docker run --rm -v nodeseeker_data:/data -v $(pwd):/backup alpine tar czf /backup/data-backup.tar.gz /data
```

### æ›´æ–°åº”ç”¨
```bash
# é‡æ–°æ„å»ºå¹¶é‡å¯
docker-compose down
docker-compose build --no-cache
docker-compose up -d

# æˆ–ä½¿ç”¨ Watchtower è‡ªåŠ¨æ›´æ–°ï¼ˆå·²é…ç½®ï¼‰
```

## ğŸ¯ æ€§èƒ½è°ƒä¼˜å»ºè®®

1. **æ•°æ®åº“ä¼˜åŒ–**: å®šæœŸæ‰§è¡Œæ•°æ®æ¸…ç†ä»»åŠ¡
2. **èµ„æºç›‘æ§**: ä½¿ç”¨ `docker stats` ç›‘æ§èµ„æºä½¿ç”¨
3. **æ—¥å¿—ç®¡ç†**: å®šæœŸæ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶
4. **å¤–éƒ¨ä»£ç†**: å¦‚éœ€è¦è´Ÿè½½å‡è¡¡æˆ– SSLï¼Œåœ¨å¤–éƒ¨é…ç½®åå‘ä»£ç†

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å†²çª**: æ£€æŸ¥ç«¯å£ 3010 æ˜¯å¦è¢«å ç”¨
2. **æƒé™é—®é¢˜**: ç¡®ä¿æ•°æ®ç›®å½•æƒé™æ­£ç¡®
3. **å¥åº·æ£€æŸ¥å¤±è´¥**: æ£€æŸ¥åº”ç”¨å¯åŠ¨çŠ¶æ€å’Œæ—¥å¿—
4. **ç¯å¢ƒå˜é‡**: ç¡®è®¤ JWT_SECRET ç­‰å¿…éœ€å˜é‡å·²è®¾ç½®

### è¯Šæ–­å‘½ä»¤
```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats

# è¿›å…¥å®¹å™¨è°ƒè¯•
docker exec -it nodeseeker-app /bin/bash

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker-compose logs nodeseeker

# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:3010/health
```

## ğŸŒ å¤–éƒ¨ä»£ç†é…ç½®ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦æ·»åŠ åå‘ä»£ç†ï¼Œå¯ä»¥åœ¨å®¿ä¸»æœºæˆ–å…¶ä»–å®¹å™¨ä¸­é…ç½®ï¼š

### Nginx é…ç½®ç¤ºä¾‹
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://localhost:3010;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### Traefik é…ç½®ç¤ºä¾‹
```yaml
version: '3.8'
services:
  nodeseeker:
    # ... ç°æœ‰é…ç½®
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.nodeseeker.rule=Host(`your-domain.com`)"
      - "traefik.http.services.nodeseeker.loadbalancer.server.port=3010"
```

ä¼˜åŒ–å®Œæˆï¼ç°åœ¨é¡¹ç›®é‡‡ç”¨äº†æ›´ç®€æ´çš„å•å®¹å™¨æ¶æ„ï¼Œå‡å°‘äº†å¤æ‚åº¦çš„åŒæ—¶ä¿æŒäº†ç”Ÿäº§ç¯å¢ƒçš„ç¨³å®šæ€§ã€‚